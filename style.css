body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 10px; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; color: #333; }
h2 { font-size: 1.2rem; margin: 10px 0 15px 0; text-align: center; color: #444; }
.controls { width: 100%; max-width: 800px; margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 10px; }

.top-group { width: 100%; display: flex; gap: 10px; }
input[type="file"], select { width: 100%; padding: 12px; background: #fff; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }

/* Icons */
button img, .custom-file-upload img, .copy-btn img {
  width: 24px; height: 24px; vertical-align: middle; filter: brightness(0) invert(1);
}

.custom-file-upload {
  flex: 2; padding: 10px; background: #007bff; color: white; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: background 0.2s; box-sizing: border-box; display: flex; justify-content: center; align-items: center;
}
.custom-file-upload:active { background: #0056b3; transform: translateY(1px); }

.btn-new { flex: 1; background: #28a745 !important; min-width: auto; max-width: none !important; display: flex; justify-content: center; align-items: center; }
.btn-new:active { background: #1e7e34 !important; }

.btn-group { display: flex; gap: 5px; width: 100%; max-width: 600px; flex-wrap: wrap; }

button { 
  flex: 1; padding: 10px; border: none; background: #007bff; color: white; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: background 0.2s; 
  min-width: 50px; max-width: 100px; display: flex; justify-content: center; align-items: center;
}
button:active { background: #0056b3; transform: translateY(1px); }
#btnDelete { background: #dc3545; }
#btnDelete:active { background: #c82333; }
.btn-active { background: #ffc107 !important; color: #333 !important; box-shadow: inset 0 3px 5px rgba(0,0,0,0.2); }
.btn-active img { filter: none; }

.board-wrapper { display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 900px; justify-content: center; align-items: center; flex-wrap: wrap; background: #f0f2f5; padding: 20px; border-radius: 12px; }
#board-container { width: 100%; max-width: 600px; aspect-ratio: 1 / 1; position: relative; flex: 2; }
#board { width: 100%; height: 100%; border: 1px solid #8b5a2b; background: #f9ebcf; display: block; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 2px; }

/* --- コメントボックス (折りたたみ機能) --- */
#comment-box { 
  width: 100%; 
  max-width: 600px; 
  min-width: 250px; 
  background: #fff; 
  border: 1px solid #ccc; 
  border-radius: 8px; 
  padding: 15px; 
  box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
  display: flex; 
  flex-direction: column;
  transition: all 0.3s ease;
  
  /* 開いている時のデフォルト */
  flex: 1; 
}

/* 閉じている時 */
#comment-box.collapsed {
  flex: 0 0 auto; 
  padding-bottom: 5px;
}

#comment-box h3 { 
  margin-top: 0; font-size: 1rem; border-bottom: 1px solid #eee; padding-bottom: 5px; color: #555; margin-bottom: 10px; 
  cursor: pointer; display: flex; justify-content: space-between; align-items: center; user-select: none;
}

/* 閉じている時のヘッダー */
#comment-box.collapsed h3 {
  border-bottom: none; margin-bottom: 0;
}

/* 矢印アニメーション */
.toggle-arrow { font-size: 0.8rem; transition: transform 0.3s; }
#comment-box.collapsed .toggle-arrow { transform: rotate(-90deg); }

/* 中身のラッパー */
.comment-content {
  flex: 1; display: flex; flex-direction: column; overflow: hidden;
  transition: max-height 0.3s ease, opacity 0.3s ease;
  max-height: 500px; /* 開いた時の高さ制限 */
  opacity: 1;
}

/* 閉じている時の中身 */
#comment-box.collapsed .comment-content {
  max-height: 0; opacity: 0; margin: 0; padding: 0; border: none;
}

#comment-text { flex: 1; width: 100%; font-family: inherit; font-size: 14px; line-height: 1.6; color: #444; border: 1px solid #eee; border-radius: 4px; padding: 8px; box-sizing: border-box; resize: vertical; outline: none; min-height: 200px; }
#comment-text:focus { border-color: #007bff; }

.input-group { width: 100%; max-width: 800px; display: flex; gap: 5px; margin-top: 10px; }
.status-bar { flex: 1; padding: 10px; background: #fff; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; font-family: monospace; font-size: 14px; min-height: 40px; word-break: break-all; }
.copy-btn { flex: 0 0 60px; padding: 0; font-size: 14px; background: #6c757d; color: white; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.copy-btn:active { background: #5a6268; }
#toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 12px; position: fixed; z-index: 1000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 16px; opacity: 0; transition: opacity 0.3s, bottom 0.3s; }
#toast.show { visibility: visible; opacity: 1; bottom: 50px; }
#lib-info { width: 100%; text-align: center; font-weight: bold; color: #555; margin-bottom: 5px; font-family: monospace; font-size: 14px; }

/* Modal */
.modal { position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; opacity: 1; transition: opacity 0.3s; }
.modal.hidden { display: none; opacity: 0; }
.modal-content { background-color: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.3); position: relative; text-align: left; }
.modal-content h3 { margin-top: 0; border-bottom: 2px solid #007bff; padding-bottom: 10px; color: #333; }
.modal-content h4 { margin-bottom: 5px; color: #555; }
.modal-content p { font-size: 14px; line-height: 1.6; color: #444; margin: 10px 0; }
.modal-content a { color: #007bff; text-decoration: none; font-weight: bold; }
.modal-content hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }
.close-btn { position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; color: #aaa; cursor: pointer; }
.close-btn:hover { color: #000; }

@media (max-width: 768px) {
  body { padding: 0; padding-bottom: 20px; }
  .board-wrapper { padding: 0; width: 100%; border-radius: 0; gap: 10px; }
  #board-container { max-width: 100%; width: 100%; }
  h2, .controls, .input-group, #comment-box { width: 96%; max-width: 100%; }
  #board { border-radius: 0; border-left: none; border-right: none; }
}